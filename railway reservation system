import pandas as pd 
import numpy as np
import random 
def main1():
    user_details = pd.read_csv('user.csv')
    print("---Railway System Login Portal---")
    print("Welcome to Railway Reservation System Online Login Portal")
    print("Please enter your login credentials:")
    print("If you are a new user, please register first.")
    while(True):
        selection = input("Press '1' to Login or '2' to Register: ")
        if selection == '1':
            username = input("Enter your username: ")
            password = input("Enter your password: ")
            if username in user_details["uname"].values and password in user_details["password"].values:                
                print("Login successful!")
                break
            else:
                print("Invalid username or password. Please try again. if new user, please register first.")
                continue
        elif selection == '2':
            pass
            new_username = input("Enter your desired username: ")
            if new_username in user_details.index:
                print("Username already exists. Please try a different username.")
                continue
            new_password = input("Enter your desired password: ")
            index = np.arange(len(user_details))
            index = int(index[-1] + 1)
            new_user = pd.DataFrame({'uname': [new_username], 'password': [new_password]})
            user_details = pd.concat([user_details, new_user], ignore_index=True)
            user_details.to_csv('user.csv')
            print("Registration successful! You can now log in with your new credentials.")
            continue
            
main1()

print(".......... Railway Reservation online .........")
print()
td=pd.read_csv("C:\\Users\\Documents\\train details.csv")
rt=pd.read_csv("C:\\Users\\Documents\\reservation table.csv")
def writecsv():
    rt.to_csv("C:\\Users\\Documents\\reservation table.csv",index=False)
    td.to_csv("C:\\Users\\Documents\\train details.csv",index=False)
print("1.view train details")
print("2.make a reservation")
print("3.cancellation")
print("4.view reservation details")
print("5.update reservation details")
print("6.view all reservation details")
print("7.exit")
ch=int(input("enter your choice:"))

if ch==1 :
#showing train details
    print(td)
elif ch==2:
#making a reservation
    name=input("enter your name:")
    age=int(input("enter your age:"))
    phn=int(input("enter your phone number:"))
    sname=input("enter source station:")
    dname=input("enter destination station:")
    fare=random.randint(1000,4000)
    pno=int(np.random.randint(10000,99999))
    conf=(input("do you want a confirmation(y/n):"))
    if conf=='y':
        print("your ticket is confirmed")
    rt.loc[len(rt.index)]=[pno,name,age,phn,sname,dname,conf,fare]
    writecsv()
    print("your passanger number is:",pno)
elif ch==3:
#cancelling a ticket
    pno=int(input("enter your passanger number to cancel the ticket:"))
    rt.drop(rt[rt.pno==pno].index, inplace=True)
    writecsv()
    print("your ticket is cancelled")
elif ch==4:
#viewing reservation details
    pno=int(input("enter your passanger number to view the reservation details:"))
    print(rt[rt.pno==pno])
elif ch==5:
#updating reservation details
    pno=int(input("enter your passanger number to update the reservation details:"))
    print("what do you want to update?")
    print("1.name")
    print("2.age")
    print("3.phone number")
    print("4.source station")
    print("5.destination station")
    print("6.conformation")
    up=int(input("enter your choice:"))
    if up==1:
    #updating name
        name=input("enter your name:")
        rt.loc[rt.pno==pno,'pname']=name
        writecsv()
        print("name updated successfully")
    elif up==2:
    #updating age
        age=int(input("enter your age:"))
        rt.loc[rt.pno==pno,'age']=age
        writecsv()
        print("age updated succesfully")
    elif up==3:
    #updating phone number
        phn=int(input("enter your phone number:"))
        rt.loc[rt.pno==pno,'phn']=phn
        writecsv()
        print("phone number updated successfully")
    elif up==4:
    #updating source station
        sname=input("enter source station:")
        rt.loc[rt.pno==pno,'sname']=sname
        writecsv()
        print("source station updated successfully")
    elif up==5:
    #updating destination station
        dname=input("enter destination station")
        rt.loc[rt.pno==pno,'dname']=dname
        writecsv()
        print("destination station updated successfully")
    elif up==6:
    #updating conformation
        conf=(input("do you want a confirmation(y?n):"))
        rt.loc[rt.pno==pno,'conf']=conf
        writecsv()
        print("conformation updated successfully")
    else:
        print("invalid choice")
elif ch==6:
#viewing all reservation details
    print(rt)
elif ch==7:
    #exiting the program
    exit()
else:
    print("invalid choice")




